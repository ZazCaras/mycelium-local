kind: pipeline
type: docker
name: default 

steps:
- name: unit-testing
  image: gradle:7.5.1-jdk17
  commands:
  - cd api
  - gradle test

- name: analisis-back
  image: gradle:7.5.1-jdk17
  commands:
    - cd api
    - gradle sonar

- name: notificacion-fail-back
  image: drillster/drone-email
  settings:
    host: smtp.gmail.com
    username: ddvallejoj@gmail.com
    password: jtobcnjnedbqeuhi
    from: ddvallejoj@gmail.com
    subject: Falla en ""
    body: Falla en ""
    recipients: 
      - ddvallejoj@gmail.com
      - jflores@unis.edu.gt
  when:
    status:
    - failure

- name: analisis-front
  image: node:16.18.1
  commands:
    - npm install -g sonarqube-scanner
    - sonar-scanner

- name: notificacion-fail-front
  image: drillster/drone-email
  settings:
    host: smtp.gmail.com
    username: ddvallejoj@gmail.com
    password: jtobcnjnedbqeuhi
    from: ddvallejoj@gmail.com
    subject: Falla en ""
    body: Falla en ""
    recipients: 
      - ddvallejoj@gmail.com
      - jflores@unis.edu.gt
  when:
    status:
    - failure

# - name: sonarqube-back-analysis
#   image: sonarsource/sonar-scanner-cli
#   environment:
#     SONAR_HOST_URL: http://sonarqube:9000
#   commands:
#   - cd api
#   - ./gradlew sonar

# - name: quality-gate-back
#   image: alpine
#   commands:
#   - timeout 1h drone wait

trigger: 
  branch:
    - main 